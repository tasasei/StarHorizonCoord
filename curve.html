<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Pragma" content="no-cache">
<meta charset="utf-8">
<script type="text/javascript" src="./plotly-latest.min.js" charset="utf-8"></script>
<script type="text/javascript" src="./horizonCoord.js" charset="utf-8"></script>
<!-- <script src="./horizonCoord.js" type="module"></script> -->

<title>scatter test</title>
</head>

<body>

<form id="param">
ra(deg):<input type="number" name="ra" min="0" max="360" id="ra" value="316.16639"><br>
dec(deg):<input type="number" name="dec" min="0" max="360" id="dec" value="38.49975"><br>
longtitude:<input type="number" name="lng" min="-180" max="180" id="lng" value="139.5"><br>
latitude:<input type="number" name="lat" min="-90" max="90" id="lat" value="35.788889"><br>
local time:<input type="datetime-local" name="datetime" min="1900-04-01T00:00" max="2100-2-27T00:00" id="datetime" value="1978-06-10T21:20"><br>
time zone:<input id="timezone" type="number" min="-12" max="12" value="9">
<!-- 1978-05-10T21:20:00+09:00 -->
</form>

<button type=button onclick="plot()">calc</button>

<div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>
</body>

<script>
function plot(){
  var ra = Number(document.forms.param.ra.value);
  var dec = Number(document.forms.param.dec.value);
  var lng = Number(document.forms.param.lng.value);
  var lat = Number(document.forms.param.lat.value);

  var dt = new Date( Date.parse(document.forms.param.datetime.value) );
  var timezone = Number(document.forms.param.timezone.value);
  dt.setHours(dt.getHours() - timezone);

  var yearUTC = dt.getFullYear();
  var monthUTC = dt.getMonth() + 1; // Jan=0, Feb=1, ...
  var dateUTC = dt.getDate();
  var hoursUTC = Number(dt.getHours());
  var minutesUTC = dt.getMinutes();
  var h = [];
  var A = [];
  var hoursArray = [];
  // alert(horizonCoord(ra, dec, lat, lng, year, month, date, hours, minutes).h);
  //  alert(horizonCoord(ra, dec, dt, lat ,lng));
  // alert(dt.getMonth());
  // alert([ra,dec,lat,lng,year,month,date,hours,minutes]);
  var ah;

  for(let i = -2; i < 5; i++){
    let d = new Date(yearUTC,monthUTC,dateUTC,hoursUTC+i,minutesUTC);
    hoursArray.push(hoursUTC + minutesUTC/60 + i);
    ah = horizonCoord(ra, dec, lat, lng, d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes());
    h.push(ah.h);
    A.push(ah.A);
  }
//   alert(document.forms.param.datetime.value);

  var trace1 = {
    // x: [1, 2, 3, 4],
    // y: [10, 15, 13, 17],
    x: hoursArray,
    y: h,
    type: 'scatter'
  };
/*
  var trace2 = {
    x: [1, 2, 3, 4],
    y: [16, 5, 11, 9],
    type: 'scatter'
  };
*/
  var data = [trace1];

  var layout = {
    yaxis: {range: [0,90]}
  };

  Plotly.newPlot('myDiv', data, layout);
}
</script>

</html>
